<!-- indexer::stop -->
<div class="<?php echo $this->class; ?> block"<?php echo $this->cssID; ?><?php if ($this->style): ?> style="<?php echo $this->style; ?>"<?php endif; ?>>

<?php if ($this->headline): ?>
<<?php echo $this->hl; ?>><?php echo $this->headline; ?></<?php echo $this->hl; ?>>
<?php endif; ?>

<div class="social-feed-container"></div>

<?php
if($this->fbStatus) {
    $fbStatus = "
    facebook:{
        accounts: ".$this->fbAccounts.",
        limit: ".$this->fbLimit.",
        access_token: '".$this->fbToken."'
    },";
} ?>

<?php if($this->gpStatus) {
    $gpStatus = "
    google:{
        accounts: ".$this->gpAccounts.",
        limit: ".$this->gpLimit.",
        access_token: '".$this->gpToken."'
    },";
} ?>

<?php
if($this->enableMasonry) {
    $masonry = "
        setTimeout(function() {
            $('.social-feed-container').masonry({
                itemSelector: '.social-feed-element'
            });
        }, 3000)
    ";
}
?>

<?php
    $generalSettings = "
    length:".$this->textLength.",
    media_min_width: ".$this->mediaMinWidth.",
    template: '".$this->itemTemplate."?_=".time()."',
    show_media: ".$this->showMedia.",
    update_period: ".$this->updatePeriod.",
    date_format: '".$this->dateFormat."',
    date_locale: '".$this->dateLocale."',
    // Function: if returns false, template will have class hidden
    /*moderation: function(content) {
        return  (content.text) ? content.text.indexOf('fuck') == -1 : true;
    },*/
    // Function: This is a callback function which is evoked when all the posts are collected and displayed
    /*callback: function() {
       console.log('All posts collected!');
    }*/
    " ;
?>


<?php $GLOBALS['TL_BODY'][] = "
<script>
$(document).ready(function() {
    var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ? true : false;
    var length = 250;
    if(isMobile) {
        length = 150;
    }

    $('.social-feed-container').socialfeed({
        " . $fbStatus . $gpStatus . $generalSettings . "
    });
    ".$masonry."
});
</script>"; ?>

<?php if($this->debug): ?>
<div>
  <h2>DEBUG:</h2>
  Modulversion: <?= $this->version ?><br>
  <?php if($this->fbStatus) : ?>
    <h5>Facebook</h5>
    <p>Konten: <?= $this->fbAccounts ?><br>
      Token: <?= $this->fbToken ?><br>
      Limit: <?= $this->fbLimit ?>
    </p>
  <?php endif; ?>
  <?php if($this->gpStatus) : ?>
  <h5>Facebook</h5>
  <p>Konten: <?= $this->gpAccounts ?><br>
    Token: <?= $this->gpToken ?><br>
    Limit: <?= $this->gpLimit ?>
  </p>
  <?php endif; ?>
</div>
<?php endif; ?>
</div>

<!-- indexer::continue -->